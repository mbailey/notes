#!/usr/bin/env bash

# Dependencies: find, sort, uniq, column (part of util-linux)

set -euo pipefail

if [ $# -ne 1 ]; then
    echo "Usage: $0 <vault-path>"
    exit 1
fi

VAULT_PATH="$1"
cd "$VAULT_PATH"

echo "=== Obsidian Vault File Analysis ==="
echo

# Total file counts
echo "File Counts:"
echo "------------"
total_files=$(find . -type f | wc -l)
md_files=$(find . -type f -name "*.md" | wc -l)
echo "Total files: $total_files"
echo "Markdown files: $md_files"
echo "Non-markdown files: $((total_files - md_files))"
echo

# Top directories by file count
echo "Top Directories by File Count:"
echo "---------------------------"
find . -type f | sed 's/\/[^/]*$//' | sort | uniq -c | sort -nr | head -10 | \
    while read count dir; do
        printf "%-6s %s\n" "$count" "$dir"
    done
echo

# File types breakdown
echo "File Types Breakdown:"
echo "-------------------"
find . -type f -name "*.*" | sed 's/.*\.//' | sort | uniq -c | sort -nr | head -15 | \
    while read count ext; do
        printf "%-6s .%s\n" "$count" "$ext"
    done
echo

# Look for common problematic paths
echo "Potential Problem Areas:"
echo "----------------------"
for path in ".git" ".obsidian/plugins" ".obsidian/workspace" "node_modules"; do
    if [ -d "$path" ]; then
        count=$(find "$path" -type f | wc -l)
        echo "$count files in $path/"
    fi
done
